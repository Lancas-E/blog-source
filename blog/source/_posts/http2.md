---
title: http2.0
date: 2020-03-01 12:02:43
tags:
- http
---

{% asset_img http2.png http %}

HTTP/1.x有以下几个主要缺点：

<!-- more   -->

- HTTP/1.0一次只允许在一个TCP连接上发起一个请求，HTTP/1.1使用的流水线技术也只能部分处理请求并发，仍然会存在队列头阻塞（Head of line blocking）问题，因此客户端在需要发起多次请求时，通常会采用建立多连接来减少延迟。
- 单向请求，只能由客户端发起。
- 请求报文与响应报文首部信息使用文本格式，不够健壮。
- 数据未压缩，导致数据的传输量大。

HTTP/2（超文本传输协议第2版，最初命名为HTTP2.0），是HTTP协议的第二个主要版本。HTTP/2是HTTP协议自1999年HTTP1.1发布后的首个更新，主要基于谷歌的SPDY协议。HTTP/2 必须采用 SSL 安全连接。
HTTP2.0的特点是：在不改动HTTP语义、方法、状态码、URI及首部字段的情况下，大幅度提高了web性能。主要有以下特点：

- **二进制分帧层**
连接 Connection ：1个TCP连接包含多个Stream；
数据流 Stream ：一个双向通讯数据流，包含1条或多条 message；
消息 Message ：对应HTTP/1.x 中的请求或者响应，包含一个或者多条 Frame；
数据帧 Frame ： 最小单位，以二进制压缩格式存放传输内容，每个帧会标识出该帧属于哪个流。
{% asset_img http2-stream.webp http2-stream %}
为了保证HTTP不受影响，那就需要在应用层（HTTP2.0）和传输层（TCP or UDP）之间增加一个二进制分帧层。在二进制分帧层上，HTTP2.0会将所有传输的信息分为更小的消息和帧，并采用二进制格式编码，其中HTTP1.x的首部信息会被封装到Headers帧，而Request Body则封装到Data帧。

- **多路复用**
我们经常会使用到雪碧图、使用多个域名等方式来进行优化，都是因为在HTTP1.0中，TCP连接是串行处理请求的，容易出现队头阻塞，资源需要等待其他资源请求完成后才能继续发送。
HTTP2.0中，采用了帧（frame）和流（stream）来处理传输内容。所谓多路复用，即在一个TCP连接中存在多个流，即可以同时发送多个请求，对端可以通过帧中的表示知道该帧属于哪个请求。在客户端，这些帧乱序发送，到对端后再根据每个帧首部的流标识符重新组装。通过该技术，可以避免HTTP旧版本的队头阻塞问题，极大提高传输性能。因此使用HTTP2.0，对应一个域名只需要建立一条TCP连接。

- **Header压缩**
在HTTP1.0中，使用文本的形式传输header，在header中携带cookie的话，每次都需要重复传输几百到几千的字节，这着实是一笔不小的开销。
在HTTP2.0中，使用了HPACK（HTTP2头部压缩算法）压缩格式对传输的header进行编码，减少了header的大小。并在两端维护了索引表，用于记录出现过的header，后面在传输过程中就可以传输已经记录过的header的键名，对端收到数据后就可以通过键名找到对应的值，这样只需要传递header中变化的内容即可。

- **服务器Push**
在HTTP2.0中，服务端可以在客户端某个请求后，主动推送其他资源。
可以想象一下，某些资源客户端是一定会请求的，这时就可以采取服务端push的技术，提前给客户端推送必要的资源，就可以相对减少一点延迟时间。在浏览器兼容的情况下也可以使用prefetch。
